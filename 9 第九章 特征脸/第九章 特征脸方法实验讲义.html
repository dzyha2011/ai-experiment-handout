<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰¹å¾è„¸æ–¹æ³•å®éªŒæ•™å­¦ç½‘é¡µ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            text-align: center;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: #666;
            font-size: 1.2em;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .nav-tab {
            padding: 12px 25px;
            margin: 0 5px;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            color: #666;
        }

        .nav-tab.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .nav-tab:hover {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            transform: translateY(-1px);
        }

        .content-section {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            color: #2c3e50;
            font-size: 2em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .subsection {
            margin-bottom: 30px;
        }

        .subsection h3 {
            color: #34495e;
            font-size: 1.4em;
            margin-bottom: 15px;
            padding-left: 15px;
            border-left: 4px solid #667eea;
        }

        .math-formula {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #667eea;
            font-family: 'Times New Roman', serif;
            text-align: center;
        }

        .code-container {
            background: #2d3748;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .code-header {
            background: #4a5568;
            padding: 12px 20px;
            color: white;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .download-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .download-btn:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }

        .code-content {
            padding: 20px;
            color: #e2e8f0;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.5;
            overflow-x: auto;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .result-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .result-card:hover {
            transform: translateY(-5px);
        }

        .result-card img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .result-card h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .interactive-demo {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .demo-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .demo-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .demo-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
        }

        .demo-output {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            font-family: monospace;
            text-align: left;
            min-height: 100px;
            backdrop-filter: blur(5px);
        }

        .performance-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .performance-table th,
        .performance-table td {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }

        .performance-table th {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-weight: 500;
        }

        .performance-table tr:hover {
            background: #f8f9fa;
        }

        .highlight {
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: bold;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid;
        }

        .alert-info {
            background: #e3f2fd;
            border-color: #2196f3;
            color: #1976d2;
        }

        .alert-warning {
            background: #fff3e0;
            border-color: #ff9800;
            color: #f57c00;
        }

        .footer {
            text-align: center;
            padding: 30px;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 50px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .nav-tab {
                margin: 5px 0;
            }
            
            .demo-controls {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <!-- è¿”å›ä¸»é¡µæŒ‰é’® -->
    <div style="
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 1000;
    ">
        <a href="../index.html" style="
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: rgba(255,255,255,0.9);
            color: #667eea;
            text-decoration: none;
            border-radius: 25px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        " onmouseover="this.style.background='white'; this.style.transform='scale(1.05)'" onmouseout="this.style.background='rgba(255,255,255,0.9)'; this.style.transform='scale(1)'">
            <span style="font-size: 18px;">â†</span>
            <span>è¿”å›ä¸»é¡µ</span>
        </a>
    </div>

    <div class="container">
        <div class="header">
            <h1>ğŸ­ ç‰¹å¾è„¸æ–¹æ³•å®éªŒæ•™å­¦</h1>
            <p>åŸºäºä¸»æˆåˆ†åˆ†æ(PCA)çš„äººè„¸è¯†åˆ«æŠ€æœ¯æ·±åº¦è§£æ</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showSection('theory')">ğŸ“š ç†è®ºåŸºç¡€</button>
            <button class="nav-tab" onclick="showSection('implementation')">ğŸ’» ä»£ç å®ç°</button>
            <button class="nav-tab" onclick="showSection('results')">ğŸ“Š å®éªŒç»“æœ</button>
            <button class="nav-tab" onclick="showSection('thinking')">ğŸ¤” æ€è€ƒé¢˜</button>
            <button class="nav-tab" onclick="showSection('interactive')">ğŸ® äº¤äº’æ¼”ç¤º</button>
        </div>

        <!-- ç†è®ºåŸºç¡€éƒ¨åˆ† -->
        <div id="theory" class="content-section active">
            <h2 class="section-title">ğŸ“š ç‰¹å¾è„¸æ–¹æ³•ç†è®ºåŸºç¡€</h2>
            
            <div class="subsection">
                <h3>ğŸ¯ èƒŒæ™¯ä¸åŸç†æ¦‚è¿°</h3>
                <p>ç‰¹å¾è„¸ï¼ˆEigenfaceï¼‰æ˜¯åŸºäº<span class="highlight">ä¸»æˆåˆ†åˆ†æï¼ˆPCAï¼‰</span>çš„ç»å…¸äººè„¸è¯†åˆ«æ–¹æ³•ï¼Œç”±Turkå’ŒPentlandäº1991å¹´æå‡ºã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯å°†é«˜ç»´äººè„¸å›¾åƒæ•°æ®é€šè¿‡<strong>é™ç»´</strong>æ˜ å°„åˆ°ä½ç»´ç‰¹å¾ç©ºé—´ï¼Œæå–æœ€èƒ½è¡¨å¾äººè„¸å·®å¼‚çš„"ä¸»æˆåˆ†"ï¼ˆå³ç‰¹å¾è„¸ï¼‰ï¼Œä»è€Œå®ç°é«˜æ•ˆçš„äººè„¸è¯†åˆ«ä¸å›¾åƒé‡å»ºã€‚</p>
            </div>

            <div class="subsection">
                <h3>ğŸ”¬ æ•°å­¦åŸç†ï¼šä¸»æˆåˆ†åˆ†æï¼ˆPCAï¼‰</h3>
                
                <h4>ğŸ“ é«˜ç»´æ•°æ®é™ç»´åŠ¨æœº</h4>
                <p>ä¸€å¼ 50Ã—50çš„äººè„¸å›¾åƒå¯è§†ä¸º2500ç»´å‘é‡ï¼ˆâ„Â²âµâ°â°ï¼‰ï¼Œç›´æ¥å¤„ç†æ˜“å—"ç»´æ•°ç¾éš¾"å½±å“ã€‚PCAé€šè¿‡<strong>çº¿æ€§å˜æ¢</strong>å°†é«˜ç»´æ•°æ®æŠ•å½±åˆ°ä½ç»´å­ç©ºé—´ï¼Œä¿ç•™æ•°æ®çš„ä¸»è¦æ–¹å·®ï¼ˆä¿¡æ¯ï¼‰ï¼ŒåŒæ—¶é™ä½è®¡ç®—å¤æ‚åº¦ã€‚</p>
                
                <h4>âš™ï¸ æ ¸å¿ƒæ­¥éª¤</h4>
                <div class="alert alert-info">
                    <strong>æ­¥éª¤1ï¼šæ•°æ®ä¸­å¿ƒåŒ–</strong><br>
                    è®¡ç®—æ‰€æœ‰æ ·æœ¬çš„å¹³å‡å‘é‡ï¼ˆå¹³å‡è„¸ï¼‰ï¼Œå°†æ¯ä¸ªæ ·æœ¬å‡å»å¹³å‡è„¸ï¼Œå¾—åˆ°å·®å¼‚çŸ©é˜µï¼š
                </div>
                <div class="math-formula">
                    <strong>X = [xâ‚ - xÌ„, xâ‚‚ - xÌ„, ..., xâ‚™ - xÌ„] âˆˆ â„á´°Ë£á´º</strong><br>
                    å…¶ä¸­ D ä¸ºå›¾åƒç»´åº¦ï¼ˆå¦‚2500ï¼‰ï¼ŒN ä¸ºæ ·æœ¬æ•°ï¼ŒxÌ„ = (1/N)âˆ‘xáµ¢ ä¸ºå¹³å‡è„¸
                </div>

                <div class="alert alert-info">
                    <strong>æ­¥éª¤2ï¼šåæ–¹å·®çŸ©é˜µè®¡ç®—</strong><br>
                    å·®å¼‚çŸ©é˜µçš„åæ–¹å·®çŸ©é˜µä¸ºï¼š
                </div>
                <div class="math-formula">
                    <strong>C = (1/(N-1)) X Xáµ€ âˆˆ â„á´°Ë£á´°</strong>
                </div>

                <div class="alert alert-info">
                    <strong>æ­¥éª¤3ï¼šç‰¹å¾å€¼åˆ†è§£</strong><br>
                    å¯¹åæ–¹å·®çŸ©é˜µè¿›è¡Œç‰¹å¾å€¼åˆ†è§£ï¼Œå¾—åˆ°ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡ï¼ˆç‰¹å¾è„¸ï¼‰
                </div>

                <div class="alert alert-info">
                    <strong>æ­¥éª¤4ï¼šä¸»æˆåˆ†é€‰æ‹©</strong><br>
                    é€‰å–å‰Kä¸ªæœ€å¤§ç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡ï¼Œæ„æˆç‰¹å¾è„¸ç©ºé—´
                </div>
                <div class="math-formula">
                    <strong>yáµ¢ = Uáµ€(xáµ¢ - xÌ„) âˆˆ â„á´·</strong><br>
                    å…¶ä¸­ U = [uâ‚, ..., uâ‚–] âˆˆ â„á´°Ë£á´·
                </div>
            </div>

            <div class="subsection">
                <h3>ğŸ¨ ç‰¹å¾è„¸çš„ç‰©ç†æ„ä¹‰</h3>
                <ul style="margin-left: 20px; line-height: 2;">
                    <li><strong>å¹³å‡è„¸</strong>ï¼šæ‰€æœ‰æ ·æœ¬çš„ç°åº¦å€¼å¹³å‡ï¼Œåæ˜ äººè„¸çš„"å…±æ€§"ç»“æ„ï¼ˆå¦‚äº”å®˜ä½ç½®ï¼‰</li>
                    <li><strong>ç‰¹å¾è„¸</strong>ï¼šåç¦»å¹³å‡è„¸çš„ä¸»è¦æ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œç¬¬1ä¸ªç‰¹å¾è„¸å¯èƒ½å¯¹åº”"å…‰ç…§å˜åŒ–"ï¼Œç¬¬2ä¸ªå¯¹åº”"è¡¨æƒ…å˜åŒ–"</li>
                    <li><strong>ä½ç»´æŠ•å½±</strong>ï¼šå°†äººè„¸å›¾åƒè¡¨ç¤ºä¸ºç‰¹å¾è„¸çš„çº¿æ€§ç»„åˆï¼Œå®ç°æ•°æ®å‹ç¼©ä¸ç‰¹å¾æå–</li>
                </ul>
            </div>
        </div>

        <!-- ä»£ç å®ç°éƒ¨åˆ† -->
        <div id="implementation" class="content-section">
            <h2 class="section-title">ğŸ’» Pythonä»£ç å®ç°</h2>
            
            <div class="subsection">
                <h3>ğŸ› ï¸ ç¯å¢ƒé…ç½®ä¸æ•°æ®é›†</h3>
                <div class="alert alert-warning">
                    <strong>ç¯å¢ƒè¦æ±‚ï¼š</strong> Python 3.xï¼Œä¾èµ–åº“ï¼šnumpyã€matplotlibã€PILã€opencv-python<br>
                    <strong>æ•°æ®é›†ï¼š</strong> YaleBäººè„¸æ•°æ®é›†ï¼ŒåŒ…å«10åå¿—æ„¿è€…çš„640å¼ æ­£è„¸å›¾åƒ
                </div>
            </div>

            <div class="subsection">
                <h3>ğŸ“– æ ¸å¿ƒç®—æ³•å®ç°</h3>
                
                <div class="code-container">
                    <div class="code-header">
                        <span>ğŸ”§ å›¾åƒæ•°æ®è¯»å–å‡½æ•°</span>
                        <button class="download-btn" onclick="downloadCode('get_images')">
                            ğŸ“¥ ä¸‹è½½ä»£ç 
                        </button>
                    </div>
                    <div class="code-content">
<pre><code>def get_images(path):
    """è¯»å–æ–‡ä»¶å¤¹ä¸­çš„äººè„¸å›¾åƒï¼Œè¿”å›å±•å¹³åçš„å›¾åƒçŸ©é˜µå’Œæ ‡ç­¾"""
    # è·å–æ‰€æœ‰å›¾åƒè·¯å¾„
    image_paths = [os.path.join(path, f) for f in os.listdir(path) if f.endswith('png')]
    
    # è¯»å–ç¬¬ä¸€å¼ å›¾ç‰‡è·å–å°ºå¯¸
    first_img = Image.open(image_paths[0]).convert('L')
    img_size = first_img.size[0] * first_img.size[1]
    
    # åˆå§‹åŒ–å›¾åƒçŸ©é˜µï¼ˆè¡Œæ•°=å›¾åƒç»´åº¦ï¼Œåˆ—æ•°=æ ·æœ¬æ•°ï¼‰
    images = np.zeros((len(image_paths), img_size))
    labels = []
    
    for idx, img_path in enumerate(image_paths):
        # è¯»å–å›¾åƒå¹¶è½¬ä¸ºç°åº¦å›¾
        img = Image.open(img_path).convert('L')  # å¡«ç©º1ï¼šè¡¥å……å›¾åƒè¯»å–æ¨¡å¼
        img_array = np.array(img, 'uint8')
        # å±•å¹³ä¸º1ç»´å‘é‡å¹¶å­˜å…¥çŸ©é˜µ
        img_flat = img_array.flatten()  # å¡«ç©º2ï¼šè¡¥å……å±•å¹³æ“ä½œ
        images[idx, :] = img_flat
        # æå–æ ‡ç­¾
        filename = os.path.basename(img_path)
        label = filename.split('_')[0][-2:]  # å¡«ç©º3ï¼šè¡¥å……æ ‡ç­¾æå–é€»è¾‘
        labels.append(label)
    
    return images.T, labels  # è¿”å›å½¢çŠ¶ä¸º(D, N)çš„å›¾åƒçŸ©é˜µå’Œæ ‡ç­¾åˆ—è¡¨</code></pre>
                    </div>
                </div>

                <div class="code-container">
                    <div class="code-header">
                        <span>ğŸ§  ç‰¹å¾è„¸è®­ç»ƒå‡½æ•°</span>
                        <button class="download-btn" onclick="downloadCode('eigen_train')">
                            ğŸ“¥ ä¸‹è½½ä»£ç 
                        </button>
                    </div>
                    <div class="code-content">
<pre><code>def eigen_train(trainset, K=10):
    """è®­ç»ƒç‰¹å¾è„¸æ¨¡å‹ï¼Œè¿”å›top-Kç‰¹å¾è„¸ã€å¹³å‡è„¸ã€è®­ç»ƒæ ·æœ¬æŠ•å½±"""
    # è®¡ç®—å¹³å‡è„¸
    avg_img = np.mean(trainset, axis=1, keepdims=True)  # å¡«ç©º4ï¼šè¡¥å……å¹³å‡è„¸è®¡ç®—
    # è®¡ç®—å·®å¼‚çŸ©é˜µï¼ˆæ¯ä¸ªæ ·æœ¬å‡å»å¹³å‡è„¸ï¼‰
    diff = trainset - avg_img  # å¡«ç©º5ï¼šè¡¥å……å·®å¼‚çŸ©é˜µè®¡ç®—
    # è®¡ç®—åæ–¹å·®çŸ©é˜µçš„ç‰¹å¾å€¼ä¸ç‰¹å¾å‘é‡
    cov_matrix = (diff.T @ diff) / float(diff.shape[1])  # å¡«ç©º6ï¼šè¡¥å……åæ–¹å·®çŸ©é˜µè®¡ç®—
    eig_vals, eig_vects = np.linalg.eig(cov_matrix)  # ç‰¹å¾å€¼åˆ†è§£
    
    # æŒ‰ç‰¹å¾å€¼é™åºæ’åºï¼Œå–å‰Kä¸ªç‰¹å¾å‘é‡
    sorted_idx = np.argsort(eig_vals)[::-1]  # å¡«ç©º7ï¼šè¡¥å……æ’åºç´¢å¼•ï¼ˆé™åºï¼‰
    top_eig_vects = eig_vects[:, sorted_idx[:K]]
    
    # è®¡ç®—ç‰¹å¾è„¸ï¼ˆå·®å¼‚çŸ©é˜µÃ—ç‰¹å¾å‘é‡ï¼‰
    eigenfaces = diff @ top_eig_vects  # å¡«ç©º8ï¼šè¡¥å……ç‰¹å¾è„¸è®¡ç®—
    
    # ç‰¹å¾è„¸å½’ä¸€åŒ–
    for i in range(eigenfaces.shape[1]):
        eigenfaces[:, i] = eigenfaces[:, i] / np.linalg.norm(eigenfaces[:, i])
    
    # è®­ç»ƒæ ·æœ¬æŠ•å½±åˆ°ç‰¹å¾è„¸ç©ºé—´
    trainset_proj = eigenfaces.T @ diff  # å¡«ç©º9ï¼šè¡¥å……æŠ•å½±è®¡ç®—
    
    return eigenfaces, avg_img, trainset_proj, eig_vals[sorted_idx[:K]]</code></pre>
                    </div>
                </div>

                <div class="code-container">
                    <div class="code-header">
                        <span>ğŸ¯ äººè„¸è¯†åˆ«æµ‹è¯•å‡½æ•°</span>
                        <button class="download-btn" onclick="downloadCode('eigen_test')">
                            ğŸ“¥ ä¸‹è½½ä»£ç 
                        </button>
                    </div>
                    <div class="code-content">
<pre><code>def eigen_test(trainset_proj, avg_img, eigenfaces, trainset_labels, testset):
    """æµ‹è¯•ç‰¹å¾è„¸æ¨¡å‹ï¼Œè¿”å›é¢„æµ‹æ ‡ç­¾"""
    # æµ‹è¯•æ ·æœ¬å‡å»å¹³å‡è„¸
    diff_test = testset - avg_img
    # æŠ•å½±åˆ°ç‰¹å¾è„¸ç©ºé—´
    testset_proj = eigenfaces.T @ diff_test  # å¡«ç©º10ï¼šè¡¥å……æµ‹è¯•æ ·æœ¬æŠ•å½±
    
    pred_labels = []
    for i in range(testset_proj.shape[1]):
        # è®¡ç®—ä¸æ‰€æœ‰è®­ç»ƒæ ·æœ¬çš„æ¬§æ°è·ç¦»
        distances = np.linalg.norm(trainset_proj - testset_proj[:, i:i+1], axis=0)  # å¡«ç©º11ï¼šè¡¥å……è·ç¦»è®¡ç®—
        # æ‰¾æœ€è¿‘é‚»
        min_idx = np.argmin(distances)
        pred_label = trainset_labels[min_idx]
        pred_labels.append(pred_label)
    
    return pred_labels</code></pre>
                    </div>
                </div>

                <div class="code-container">
                    <div class="code-header">
                        <span>ğŸš€ å®Œæ•´å®éªŒä¸»å‡½æ•°</span>
                        <button class="download-btn" onclick="downloadCode('main_experiment')">
                            ğŸ“¥ ä¸‹è½½å®Œæ•´ä»£ç 
                        </button>
                    </div>
                    <div class="code-content">
<pre><code># 1. åŠ è½½æ•°æ®
trainset, trainset_labels = get_images('./yaleBfaces/subset0')  # è®­ç»ƒé›†ï¼šsubset0
testset, testset_labels = get_images('./yaleBfaces/subset1')    # æµ‹è¯•é›†ï¼šsubset1

# 2. è®­ç»ƒæ¨¡å‹ï¼ˆæå–å‰Kä¸ªç‰¹å¾è„¸ï¼‰
K = 20
eigenfaces, avg_img, trainset_proj, eigenvalues = eigen_train(trainset, K)

# 3. æµ‹è¯•æ¨¡å‹
pred_labels = eigen_test(trainset_proj, avg_img, eigenfaces, trainset_labels, testset)

# 4. è®¡ç®—å‡†ç¡®ç‡
correct = sum(p == t for p, t in zip(pred_labels, testset_labels))
accuracy = correct / len(testset_labels)
print(f"K={K}æ—¶ï¼Œè¯†åˆ«å‡†ç¡®ç‡ï¼š{accuracy:.2f}")</code></pre>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3>ğŸ“ ä»£ç å¡«ç©ºé¢˜ç­”æ¡ˆ</h3>
                <div class="alert alert-info">
                    <ol style="margin-left: 20px; line-height: 2;">
                        <li><code>'L'</code>ï¼ˆç°åº¦å›¾æ¨¡å¼ï¼‰</li>
                        <li><code>img_array.flatten()</code>ï¼ˆå°†2Då›¾åƒå±•å¹³ä¸º1Då‘é‡ï¼‰</li>
                        <li><code>filename.split('_')[0][-2:]</code>ï¼ˆä»æ–‡ä»¶åæå–æ ‡ç­¾ï¼‰</li>
                        <li><code>np.mean(trainset, axis=1, keepdims=True)</code>ï¼ˆæŒ‰åˆ—è®¡ç®—å¹³å‡ï¼‰</li>
                        <li><code>trainset - avg_img</code>ï¼ˆæ¯ä¸ªæ ·æœ¬å‡å»å¹³å‡è„¸ï¼‰</li>
                        <li><code>(diff.T @ diff) / float(diff.shape[1])</code>ï¼ˆåæ–¹å·®çŸ©é˜µï¼‰</li>
                        <li><code>np.argsort(eig_vals)[::-1]</code>ï¼ˆç‰¹å¾å€¼é™åºæ’åºï¼‰</li>
                        <li><code>diff @ top_eig_vects</code>ï¼ˆè®¡ç®—ç‰¹å¾è„¸ï¼‰</li>
                        <li><code>eigenfaces.T @ diff</code>ï¼ˆè®­ç»ƒæ ·æœ¬æŠ•å½±ï¼‰</li>
                        <li><code>eigenfaces.T @ diff_test</code>ï¼ˆæµ‹è¯•æ ·æœ¬æŠ•å½±ï¼‰</li>
                        <li><code>np.linalg.norm(trainset_proj - testset_proj[:, i:i+1], axis=0)</code>ï¼ˆæ¬§æ°è·ç¦»ï¼‰</li>
                    </ol>
                </div>
            </div>
        </div>

        <!-- å®éªŒç»“æœéƒ¨åˆ† -->
        <div id="results" class="content-section">
            <h2 class="section-title">ğŸ“Š å®éªŒç»“æœä¸åˆ†æ</h2>
            
            <div class="subsection">
                <h3>ğŸ¨ ç‰¹å¾è„¸å¯è§†åŒ–ç»“æœ</h3>
                <div class="result-grid">
                    <div class="result-card">
                        <img src="eigenfaces_visualization.png" alt="ç‰¹å¾è„¸å¯è§†åŒ–">
                        <h4>å¹³å‡è„¸ä¸å‰9ä¸ªç‰¹å¾è„¸</h4>
                        <p>å¹³å‡è„¸æ˜¾ç¤ºäº†æ‰€æœ‰è®­ç»ƒæ ·æœ¬çš„å¹³å‡ç‰¹å¾ï¼Œå‰å‡ ä¸ªç‰¹å¾è„¸ä¸»è¦æ•æ‰å…‰ç…§å˜åŒ–å’Œæ•´ä½“äº®åº¦å·®å¼‚ï¼Œåç»­ç‰¹å¾è„¸ä½“ç°æ›´ç»†å¾®çš„ä¸ªä½“å·®å¼‚ã€‚</p>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3>ğŸ“ˆ è¯†åˆ«å‡†ç¡®ç‡ä¸Kå€¼å…³ç³»</h3>
                <div class="result-grid">
                    <div class="result-card">
                        <img src="accuracy_vs_k.png" alt="å‡†ç¡®ç‡ä¸Kå€¼å…³ç³»">
                        <h4>ä¸åŒä¸»æˆåˆ†æ•°é‡çš„æ€§èƒ½å¯¹æ¯”</h4>
                        <p>å®éªŒç»“æœè¡¨æ˜Kå€¼ä»5å¢åŠ åˆ°10æ—¶å‡†ç¡®ç‡æ˜¾è‘—æå‡ï¼ŒK>15åå‡†ç¡®ç‡è¶‹äºç¨³å®šï¼Œè¯´æ˜å‰15ä¸ªä¸»æˆåˆ†å·²åŒ…å«äº†å¤§éƒ¨åˆ†æœ‰æ•ˆä¿¡æ¯ã€‚</p>
                    </div>
                </div>
                
                <table class="performance-table">
                    <thead>
                        <tr>
                            <th>Kå€¼</th>
                            <th>5</th>
                            <th>10</th>
                            <th>15</th>
                            <th>20</th>
                            <th>25</th>
                            <th>30</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>å‡†ç¡®ç‡ï¼ˆsubset1ï¼‰</strong></td>
                            <td>0.692</td>
                            <td>0.933</td>
                            <td>0.942</td>
                            <td>0.942</td>
                            <td>0.942</td>
                            <td>0.942</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="subsection">
                <h3>ğŸŒŸ å›¾åƒé‡å»ºè´¨é‡åˆ†æ</h3>
                <div class="result-grid">

                    <div class="result-card">
                        <img src="detailed_reconstruction.png" alt="å¤šå¼ äººè„¸é‡å»ºå¯¹æ¯”">
                        <h4>å¤šå¼ äººè„¸çš„é‡å»ºæ•ˆæœå¯¹æ¯”</h4>
                        <p>å±•ç¤ºäº†6å¼ ä¸åŒäººè„¸åœ¨K=20æ—¶çš„é‡å»ºæ•ˆæœï¼Œå¯ä»¥çœ‹å‡ºç‰¹å¾è„¸æ–¹æ³•å¯¹ä¸åŒä¸ªä½“éƒ½èƒ½è¾ƒå¥½åœ°ä¿æŒä¸»è¦ç‰¹å¾ï¼Œä½†åœ¨ç»†èŠ‚è¡¨ç°ä¸Šå­˜åœ¨å·®å¼‚ã€‚</p>
                    </div>
                    <div class="result-card">
                        <img src="reconstruction_quality_analysis.png" alt="é‡å»ºè´¨é‡åˆ†æ">
                        <h4>é‡å»ºè´¨é‡éšKå€¼å˜åŒ–åˆ†æ</h4>
                        <p>é€šè¿‡MSEï¼ˆå‡æ–¹è¯¯å·®ï¼‰é‡åŒ–é‡å»ºè´¨é‡ï¼ŒKå€¼ä»1å¢åŠ åˆ°50æ—¶ï¼Œé‡å»ºè¯¯å·®é€æ¸å‡å°ï¼Œå›¾åƒç»†èŠ‚é€æ­¥æ¢å¤ï¼Œå±•ç°äº†ä¸»æˆåˆ†ç´¯ç§¯çš„æ•ˆæœã€‚</p>
                    </div>
                    <div class="result-card">
                        <img src="eigenface_contribution.png" alt="ç‰¹å¾è„¸è´¡çŒ®åˆ†æ">
                        <h4>ç‰¹å¾è„¸ç´¯ç§¯é‡å»ºè¿‡ç¨‹</h4>
                        <p>é€æ­¥æ·»åŠ ç‰¹å¾è„¸çš„é‡å»ºè¿‡ç¨‹ï¼šä»å¹³å‡è„¸å¼€å§‹ï¼Œæ¯å¢åŠ ä¸€ä¸ªç‰¹å¾è„¸ï¼Œé‡å»ºå›¾åƒéƒ½æ›´æ¥è¿‘åŸå›¾ï¼Œç›´è§‚å±•ç¤ºäº†PCAé™ç»´é‡å»ºçš„æ•°å­¦åŸç†ã€‚</p>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3>ğŸ’¡ å…‰ç…§å˜åŒ–å¯¹æ€§èƒ½çš„å½±å“</h3>
                <table class="performance-table">
                    <thead>
                        <tr>
                            <th>å­é›†</th>
                            <th>subset1ï¼ˆå¼±é˜´å½±ï¼‰</th>
                            <th>subset2ï¼ˆä¸­ç­‰é˜´å½±ï¼‰</th>
                            <th>subset3ï¼ˆå¼ºé˜´å½±ï¼‰</th>
                            <th>subset4ï¼ˆæç«¯é˜´å½±ï¼‰</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>å‡†ç¡®ç‡</strong></td>
                            <td>0.942</td>
                            <td>0.500</td>
                            <td>0.186</td>
                            <td>0.142</td>
                        </tr>
                    </tbody>
                </table>
                
                <div class="alert alert-warning">
                    <strong>ç»“è®ºï¼š</strong>ç‰¹å¾è„¸å¯¹å…‰ç…§å˜åŒ–éå¸¸æ•æ„Ÿï¼Œéšç€é˜´å½±ç¨‹åº¦å¢å¼ºï¼Œè¯†åˆ«å‡†ç¡®ç‡æ€¥å‰§ä¸‹é™ã€‚è¿™æ˜¯å› ä¸ºPCAä¸»è¦æ•æ‰å…¨å±€äº®åº¦å˜åŒ–ï¼Œè€Œéå±€éƒ¨çº¹ç†ç‰¹å¾ã€‚
                </div>
            </div>

            <div class="subsection">
                <h3>ğŸ” ä¸å…¶ä»–æ–¹æ³•çš„æ€§èƒ½å¯¹æ¯”</h3>
                <table class="performance-table">
                    <thead>
                        <tr>
                            <th>æ–¹æ³•</th>
                            <th>å‡†ç¡®ç‡</th>
                            <th>æ¨ç†æ—¶å»¶(ms)</th>
                            <th>è®­ç»ƒæ•°æ®éœ€æ±‚</th>
                            <th>ä¸»è¦ä¼˜åŠ¿</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>ç‰¹å¾è„¸</strong></td>
                            <td>85%</td>
                            <td>2</td>
                            <td>100+æ ·æœ¬</td>
                            <td>ç®€å•é«˜æ•ˆï¼Œé€‚åˆå¤§è§„æ¨¡æ•°æ®</td>
                        </tr>
                        <tr>
                            <td><strong>Fisherfaces</strong></td>
                            <td>93%</td>
                            <td>5</td>
                            <td>500+æ ·æœ¬</td>
                            <td>å¯¹å…‰ç…§æ›´é²æ£’</td>
                        </tr>
                        <tr>
                            <td><strong>LBPH</strong></td>
                            <td>94%</td>
                            <td>10</td>
                            <td>1000+æ ·æœ¬</td>
                            <td>å¯¹å…‰ç…§ã€é®æŒ¡é²æ£’</td>
                        </tr>
                        <tr>
                            <td><strong>CNNï¼ˆArcFaceï¼‰</strong></td>
                            <td>99.83%</td>
                            <td>50</td>
                            <td>100000+æ ·æœ¬</td>
                            <td>å‡†ç¡®ç‡æé«˜ï¼Œé²æ£’æ€§å¼º</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- æ€è€ƒé¢˜éƒ¨åˆ† -->
        <div id="thinking" class="content-section">
            <h2 class="section-title">ğŸ¤” æ€è€ƒé¢˜ä¸è®¨è®º</h2>
            
            <div class="subsection">
                <h3>ğŸ’¡ åŸºç¡€ç†è®ºæ€è€ƒ</h3>
                <div class="result-card">
                    <h4>1. ä¸ºä»€ä¹ˆè¦è®¡ç®—å¹³å‡è„¸ï¼Ÿ</h4>
                    <p><strong>æ€è€ƒè¦ç‚¹ï¼š</strong></p>
                    <ul style="margin-left: 20px; line-height: 1.8;">
                        <li>å¹³å‡è„¸åœ¨ç‰¹å¾è„¸ç®—æ³•ä¸­çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</li>
                        <li>å»ä¸­å¿ƒåŒ–æ“ä½œçš„æ•°å­¦æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ</li>
                        <li>å¦‚æœä¸è¿›è¡Œå»ä¸­å¿ƒåŒ–ä¼šæœ‰ä»€ä¹ˆå½±å“ï¼Ÿ</li>
                    </ul>
                    <div class="alert alert-info">
                        <strong>ğŸ’¡ æç¤ºï¼š</strong>è€ƒè™‘åæ–¹å·®çŸ©é˜µçš„è®¡ç®—å’Œä¸»æˆåˆ†åˆ†æçš„åŸç†
                    </div>
                </div>

                <div class="result-card">
                    <h4>2. ä¸ºä»€ä¹ˆä½¿ç”¨ A^TÂ·A è€Œä¸æ˜¯ AÂ·A^Tï¼Ÿ</h4>
                    <p><strong>æ€è€ƒè¦ç‚¹ï¼š</strong></p>
                    <ul style="margin-left: 20px; line-height: 1.8;">
                        <li>ä¸¤ç§åæ–¹å·®çŸ©é˜µè®¡ç®—æ–¹å¼çš„ç»´åº¦å·®å¼‚</li>
                        <li>è®¡ç®—å¤æ‚åº¦çš„å¯¹æ¯”åˆ†æ</li>
                        <li>ç‰¹å¾å‘é‡çš„è½¬æ¢å…³ç³»</li>
                    </ul>
                    <div class="alert alert-info">
                        <strong>ğŸ’¡ æç¤ºï¼š</strong>è€ƒè™‘å›¾åƒåƒç´ æ•°é‡ä¸æ ·æœ¬æ•°é‡çš„å…³ç³»
                    </div>
                </div>

                <div class="result-card">
                    <h4>3. Kå€¼é€‰æ‹©å¯¹è¯†åˆ«æ•ˆæœçš„å½±å“</h4>
                    <p><strong>æ€è€ƒè¦ç‚¹ï¼š</strong></p>
                    <ul style="margin-left: 20px; line-height: 1.8;">
                        <li>Kå€¼è¿‡å°ä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜ï¼Ÿ</li>
                        <li>Kå€¼è¿‡å¤§ä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜ï¼Ÿ</li>
                        <li>å¦‚ä½•é€‰æ‹©æœ€ä¼˜çš„Kå€¼ï¼Ÿ</li>
                    </ul>
                    <div class="alert alert-info">
                        <strong>ğŸ’¡ æç¤ºï¼š</strong>è§‚å¯Ÿå®éªŒç»“æœä¸­çš„å‡†ç¡®ç‡å˜åŒ–æ›²çº¿
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3>ğŸ”¬ å®éªŒåˆ†ææ€è€ƒ</h3>
                <div class="result-card">
                    <h4>4. ç‰¹å¾è„¸çš„ç‰©ç†æ„ä¹‰</h4>
                    <p><strong>æ€è€ƒè¦ç‚¹ï¼š</strong></p>
                    <ul style="margin-left: 20px; line-height: 1.8;">
                        <li>è§‚å¯Ÿç‰¹å¾è„¸å›¾åƒï¼Œå®ƒä»¬ä»£è¡¨ä»€ä¹ˆï¼Ÿ</li>
                        <li>ä¸ºä»€ä¹ˆæœ‰äº›ç‰¹å¾è„¸çœ‹èµ·æ¥åƒ"é¬¼è„¸"ï¼Ÿ</li>
                        <li>ä¸åŒç‰¹å¾è„¸æ•è·äº†äººè„¸çš„å“ªäº›ç‰¹å¾ï¼Ÿ</li>
                    </ul>
                    <div class="alert alert-info">
                        <strong>ğŸ’¡ æç¤ºï¼š</strong>ç‰¹å¾è„¸æ˜¯äººè„¸å˜åŒ–çš„ä¸»è¦æ¨¡å¼
                    </div>
                </div>

                <div class="result-card">
                    <h4>5. é‡å»ºè´¨é‡åˆ†æ</h4>
                    <p><strong>æ€è€ƒè¦ç‚¹ï¼š</strong></p>
                    <ul style="margin-left: 20px; line-height: 1.8;">
                        <li>ä¸ºä»€ä¹ˆK=5æ—¶é‡å»ºæ•ˆæœè¾ƒå·®ï¼Ÿ</li>
                        <li>K=50æ—¶é‡å»ºæ•ˆæœå¦‚ä½•ï¼Ÿæ˜¯å¦è¶Šå¤§è¶Šå¥½ï¼Ÿ</li>
                        <li>é‡å»ºè¯¯å·®çš„æ¥æºæœ‰å“ªäº›ï¼Ÿ</li>
                    </ul>
                    <div class="alert alert-info">
                        <strong>ğŸ’¡ æç¤ºï¼š</strong>è€ƒè™‘ä¿¡æ¯ä¿ç•™ä¸å™ªå£°çš„æƒè¡¡
                    </div>
                </div>

                <div class="result-card">
                    <h4>6. è¯†åˆ«å‡†ç¡®ç‡åˆ†æ</h4>
                    <p><strong>æ€è€ƒè¦ç‚¹ï¼š</strong></p>
                    <ul style="margin-left: 20px; line-height: 1.8;">
                        <li>ä¸ºä»€ä¹ˆå‡†ç¡®ç‡å…ˆä¸Šå‡åä¸‹é™ï¼Ÿ</li>
                        <li>æœ€ä¼˜Kå€¼åœ¨ä»€ä¹ˆèŒƒå›´å†…ï¼Ÿ</li>
                        <li>å¦‚ä½•æ”¹è¿›è¯†åˆ«ç®—æ³•çš„æ€§èƒ½ï¼Ÿ</li>
                    </ul>
                    <div class="alert alert-info">
                        <strong>ğŸ’¡ æç¤ºï¼š</strong>è€ƒè™‘æœ‰ç”¨ä¿¡æ¯ä¸å™ªå£°çš„å¹³è¡¡ç‚¹
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3>ğŸš€ åº”ç”¨æ‹“å±•æ€è€ƒ</h3>
                <div class="result-card">
                    <h4>7. ç®—æ³•å±€é™æ€§åˆ†æ</h4>
                    <p><strong>æ€è€ƒè¦ç‚¹ï¼š</strong></p>
                    <ul style="margin-left: 20px; line-height: 1.8;">
                        <li>ç‰¹å¾è„¸ç®—æ³•å¯¹å…‰ç…§å˜åŒ–æ•æ„Ÿå—ï¼Ÿ</li>
                        <li>å¯¹å§¿æ€å˜åŒ–çš„é²æ£’æ€§å¦‚ä½•ï¼Ÿ</li>
                        <li>å¦‚ä½•æ”¹è¿›è¿™äº›å±€é™æ€§ï¼Ÿ</li>
                    </ul>
                    <div class="alert alert-info">
                        <strong>ğŸ’¡ æç¤ºï¼š</strong>è€ƒè™‘ç°ä»£æ·±åº¦å­¦ä¹ æ–¹æ³•çš„ä¼˜åŠ¿
                    </div>
                </div>

                <div class="result-card">
                    <h4>8. å®é™…åº”ç”¨è€ƒè™‘</h4>
                    <p><strong>æ€è€ƒè¦ç‚¹ï¼š</strong></p>
                    <ul style="margin-left: 20px; line-height: 1.8;">
                        <li>åœ¨è€ƒå‹¤ç³»ç»Ÿä¸­ï¼Œå¦‚ä½•å¤„ç†æ–°å‘˜å·¥å…¥èŒï¼Ÿ</li>
                        <li>å¦‚ä½•è®¾ç½®åˆé€‚çš„è¯†åˆ«é˜ˆå€¼ï¼Ÿ</li>
                        <li>å¦‚ä½•å¤„ç†è¯¯è¯†åˆ«å’Œæ‹’è¯†é—®é¢˜ï¼Ÿ</li>
                    </ul>
                    <div class="alert alert-info">
                        <strong>ğŸ’¡ æç¤ºï¼š</strong>è€ƒè™‘ç³»ç»Ÿçš„å¯æ‰©å±•æ€§å’Œå®ç”¨æ€§
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3>ğŸ’¬ è®¨è®ºä¸æ€»ç»“</h3>
                <div class="result-grid">
                    <div class="result-card">
                        <h4>ğŸ¯ å­¦ä¹ ç›®æ ‡æ£€æŸ¥</h4>
                        <ul style="margin-left: 20px; line-height: 1.8;">
                            <li>âœ… ç†è§£ç‰¹å¾è„¸ç®—æ³•çš„æ•°å­¦åŸç†</li>
                            <li>âœ… æŒæ¡PCAåœ¨äººè„¸è¯†åˆ«ä¸­çš„åº”ç”¨</li>
                            <li>âœ… åˆ†æKå€¼å¯¹ç®—æ³•æ€§èƒ½çš„å½±å“</li>
                            <li>âœ… äº†è§£ç®—æ³•çš„ä¼˜åŠ¿ä¸å±€é™æ€§</li>
                            <li>âœ… æ€è€ƒå®é™…åº”ç”¨ä¸­çš„å·¥ç¨‹é—®é¢˜</li>
                        </ul>
                    </div>
                    
                    <div class="result-card">
                        <h4>ğŸ” è¿›ä¸€æ­¥æ¢ç´¢</h4>
                        <ul style="margin-left: 20px; line-height: 1.8;">
                            <li>ç ”ç©¶å…¶ä»–é™ç»´ç®—æ³•ï¼ˆLDAã€ICAç­‰ï¼‰</li>
                            <li>äº†è§£ç°ä»£äººè„¸è¯†åˆ«æŠ€æœ¯ï¼ˆCNNã€Transformerç­‰ï¼‰</li>
                            <li>æ¢ç´¢äººè„¸è¯†åˆ«çš„ä¼¦ç†å’Œéšç§é—®é¢˜</li>
                            <li>å®ç°æ›´å¤æ‚çš„äººè„¸è¯†åˆ«ç³»ç»Ÿ</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- äº¤äº’æ¼”ç¤ºéƒ¨åˆ† -->
        <div id="interactive" class="content-section">
            <h2 class="section-title">ğŸ® äº¤äº’å¼è€ƒå‹¤ç³»ç»Ÿæ¼”ç¤º</h2>
            
            <div class="interactive-demo">
                <h3>ğŸ¢ åŸºäºç‰¹å¾è„¸çš„äººè„¸è¯†åˆ«è€ƒå‹¤ç³»ç»Ÿ</h3>
                <p>æœ¬ç³»ç»Ÿå±•ç¤ºäº†ç‰¹å¾è„¸ç®—æ³•åœ¨å®é™…åº”ç”¨ä¸­çš„ä½¿ç”¨åœºæ™¯ã€‚ç³»ç»ŸåŒ…å«æ•°æ®é‡‡é›†ã€æ¨¡å‹è®­ç»ƒã€å®æ—¶è¯†åˆ«å’Œè€ƒå‹¤è®°å½•å››ä¸ªæ ¸å¿ƒåŠŸèƒ½æ¨¡å—ã€‚</p>
                
                <div class="subsection">
                    <h4>ğŸ—ï¸ ç³»ç»Ÿæ¶æ„</h4>
                    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <p><strong>1. æ•°æ®é‡‡é›†æ¨¡å—ï¼š</strong>å½•å…¥å­¦ç”Ÿäººè„¸å›¾åƒï¼ˆå­˜äºdataset/æ–‡ä»¶å¤¹ï¼‰</p>
                        <p><strong>2. æ¨¡å‹è®­ç»ƒæ¨¡å—ï¼š</strong>ç¦»çº¿è®­ç»ƒç‰¹å¾è„¸æ¨¡å‹ï¼Œä¿å­˜ç‰¹å¾è„¸ä¸å¹³å‡è„¸</p>
                        <p><strong>3. è€ƒå‹¤è¯†åˆ«æ¨¡å—ï¼š</strong>å®æ—¶é‡‡é›†äººè„¸ï¼Œä¸æ¨¡å‹åŒ¹é…ï¼Œè®°å½•å‡ºå‹¤çŠ¶æ€</p>
                        <p><strong>4. æ•°æ®ç®¡ç†æ¨¡å—ï¼š</strong>è€ƒå‹¤è®°å½•çš„å­˜å‚¨ã€æŸ¥è¯¢å’Œç»Ÿè®¡åˆ†æ</p>
                    </div>
                </div>

                <div class="demo-controls">
                    <button class="demo-btn" onclick="simulateDataCollection()">ğŸ“· æ¨¡æ‹Ÿæ•°æ®é‡‡é›†</button>
                    <button class="demo-btn" onclick="simulateTraining()">ğŸ§  æ¨¡æ‹Ÿæ¨¡å‹è®­ç»ƒ</button>
                    <button class="demo-btn" onclick="simulateRecognition()">ğŸ¯ æ¨¡æ‹Ÿå®æ—¶è¯†åˆ«</button>
                    <button class="demo-btn" onclick="showAttendanceRecord()">ğŸ“‹ æŸ¥çœ‹è€ƒå‹¤è®°å½•</button>
                </div>
                
                <div id="demo-output" class="demo-output">
                    <div style="color: #00ff88;">ğŸ’¡ ç³»ç»Ÿå°±ç»ªï¼Œè¯·é€‰æ‹©åŠŸèƒ½è¿›è¡Œæ¼”ç¤º...</div>
                    <div style="color: #88ccff; margin-top: 10px;">â„¹ï¸ æç¤ºï¼šè¿™æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿæ¼”ç¤ºï¼Œå±•ç¤ºäº†è€ƒå‹¤ç³»ç»Ÿçš„å·¥ä½œæµç¨‹å’Œç•Œé¢æ•ˆæœ</div>
                </div>
            </div>

            <div class="subsection">
                <h3>âš™ï¸ ç³»ç»Ÿæ ¸å¿ƒåŠŸèƒ½ä»£ç </h3>
                
                <div class="code-container">
                    <div class="code-header">
                        <span>ğŸ“· äººè„¸æ•°æ®é‡‡é›†æ¨¡å—</span>
                        <button class="download-btn" onclick="downloadCode('capture_face')">
                            ğŸ“¥ ä¸‹è½½ä»£ç 
                        </button>
                    </div>
                    <div class="code-content">
<pre><code>def capture_face(name, num_samples=5):
    """è°ƒç”¨æ‘„åƒå¤´é‡‡é›†äººè„¸æ ·æœ¬ï¼Œä¿å­˜è‡³dataset/name/"""
    dataset_path = f'dataset/{name}'
    os.makedirs(dataset_path, exist_ok=True)
    
    cap = cv2.VideoCapture(0)  # æ‰“å¼€æ‘„åƒå¤´
    face_cascade = cv2.CascadeClassifier(cv2.data.haarcascades + 'haarcascade_frontalface_default.xml')
    count = 0
    
    print(f"å¼€å§‹é‡‡é›† {name} çš„äººè„¸æ ·æœ¬ï¼Œéœ€è¦ {num_samples} å¼ ç…§ç‰‡")
    print("æŒ‰ç©ºæ ¼é”®æ‹ç…§ï¼ŒæŒ‰qé”®é€€å‡º")
    
    while count < num_samples:
        ret, frame = cap.read()
        if not ret:
            break
            
        # äººè„¸æ£€æµ‹
        gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)
        faces = face_cascade.detectMultiScale(gray, 1.3, 5)
        
        # ç»˜åˆ¶äººè„¸æ¡†
        for (x, y, w, h) in faces:
            cv2.rectangle(frame, (x, y), (x+w, y+h), (0, 255, 0), 2)
            cv2.putText(frame, f'{name} - {count}/{num_samples}', (x, y-10), 
                       cv2.FONT_HERSHEY_SIMPLEX, 0.7, (0, 255, 0), 2)
        
        cv2.imshow('äººè„¸é‡‡é›†', frame)
        
        key = cv2.waitKey(1) & 0xFF
        if key == ord(' ') and len(faces) > 0:  # æŒ‰ç©ºæ ¼é”®æ‹ç…§
            x, y, w, h = faces[0]
            face_roi = cv2.resize(gray[y:y+h, x:x+w], (50, 50))
            filename = f'{dataset_path}/{name}_{count:02d}.png'
            cv2.imwrite(filename, face_roi)
            print(f"å·²ä¿å­˜: {filename}")
            count += 1
        elif key == ord('q'):
            break
    
    cap.release()
    cv2.destroyAllWindows()</code></pre>
                    </div>
                </div>

                <div class="code-container">
                    <div class="code-header">
                        <span>ğŸ§  ç‰¹å¾è„¸æ¨¡å‹è®­ç»ƒæ¨¡å—</span>
                        <button class="download-btn" onclick="downloadCode('eigen_train')">
                            ğŸ“¥ ä¸‹è½½ä»£ç 
                        </button>
                    </div>
                    <div class="code-content">
<pre><code>def eigen_train(trainset, K=10):
    """è®­ç»ƒç‰¹å¾è„¸æ¨¡å‹ï¼Œè¿”å›top-Kç‰¹å¾è„¸ã€å¹³å‡è„¸ã€è®­ç»ƒæ ·æœ¬æŠ•å½±"""
    # è®¡ç®—å¹³å‡è„¸
    avg_img = np.mean(trainset, axis=1, keepdims=True)
    
    # è®¡ç®—å·®å€¼çŸ©é˜µï¼ˆå»ä¸­å¿ƒåŒ–ï¼‰
    diff = trainset - avg_img
    
    # è®¡ç®—åæ–¹å·®çŸ©é˜µ C = A^T * Aï¼ˆé™ç»´æŠ€å·§ï¼‰
    cov_matrix = (diff.T @ diff) / float(diff.shape[1])
    
    # ç‰¹å¾å€¼åˆ†è§£
    eig_vals, eig_vects = np.linalg.eig(cov_matrix)
    
    # æŒ‰ç‰¹å¾å€¼å¤§å°æ’åºï¼Œé€‰æ‹©å‰Kä¸ª
    sorted_idx = np.argsort(eig_vals)[::-1]
    top_eig_vects = eig_vects[:, sorted_idx[:K]]
    
    # è®¡ç®—çœŸæ­£çš„ç‰¹å¾å‘é‡ï¼ˆç‰¹å¾è„¸ï¼‰
    eigenfaces = diff @ top_eig_vects
    
    # å½’ä¸€åŒ–ç‰¹å¾è„¸
    for i in range(K):
        eigenfaces[:, i] = eigenfaces[:, i] / np.linalg.norm(eigenfaces[:, i])
    
    # è®¡ç®—è®­ç»ƒæ ·æœ¬åœ¨ç‰¹å¾è„¸ç©ºé—´çš„æŠ•å½±
    train_projections = eigenfaces.T @ diff
    
    return eigenfaces, avg_img, train_projections</code></pre>
                    </div>
                </div>

                <div class="code-container">
                    <div class="code-header">
                        <span>ğŸ¯ äººè„¸è¯†åˆ«æµ‹è¯•æ¨¡å—</span>
                        <button class="download-btn" onclick="downloadCode('eigen_test')">
                            ğŸ“¥ ä¸‹è½½ä»£ç 
                        </button>
                    </div>
                    <div class="code-content">
<pre><code>def eigen_test(testset, eigenfaces, avg_img, train_projections, train_labels):
    """ä½¿ç”¨ç‰¹å¾è„¸æ¨¡å‹è¿›è¡Œäººè„¸è¯†åˆ«æµ‹è¯•"""
    predictions = []
    confidences = []
    
    for i in range(testset.shape[1]):
        # æµ‹è¯•å›¾åƒå»ä¸­å¿ƒåŒ–
        test_img = testset[:, i:i+1] - avg_img
        
        # æŠ•å½±åˆ°ç‰¹å¾è„¸ç©ºé—´
        test_projection = eigenfaces.T @ test_img
        
        # è®¡ç®—ä¸æ‰€æœ‰è®­ç»ƒæ ·æœ¬çš„æ¬§æ°è·ç¦»
        distances = []
        for j in range(train_projections.shape[1]):
            train_proj = train_projections[:, j:j+1]
            dist = np.linalg.norm(test_projection - train_proj)
            distances.append(dist)
        
        # æ‰¾åˆ°æœ€è¿‘é‚»
        min_idx = np.argmin(distances)
        min_distance = distances[min_idx]
        
        # é¢„æµ‹æ ‡ç­¾å’Œç½®ä¿¡åº¦ï¼ˆè·ç¦»è¶Šå°ç½®ä¿¡åº¦è¶Šé«˜ï¼‰
        pred_label = train_labels[min_idx]
        confidence = 1.0 / (1.0 + min_distance)  # ç®€å•çš„ç½®ä¿¡åº¦è®¡ç®—
        
        predictions.append(pred_label)
        confidences.append(confidence)
    
    return predictions, confidences</code></pre>
                    </div>
                </div>

                <div class="code-container">
                    <div class="code-header">
                        <span>ğŸ“Š è€ƒå‹¤è®°å½•ç®¡ç†æ¨¡å—</span>
                        <button class="download-btn" onclick="downloadCode('attendance_system')">
                            ğŸ“¥ ä¸‹è½½ä»£ç 
                        </button>
                    </div>
                    <div class="code-content">
<pre><code>def record_attendance(pred_label, confidence=0.0, attendance_file='attendance.csv'):
    """è®°å½•è€ƒå‹¤ç»“æœï¼ˆå§“åã€æ—¶é—´ã€çŠ¶æ€ã€ç½®ä¿¡åº¦ï¼‰"""
    now = datetime.now().strftime('%Y-%m-%d %H:%M:%S')
    
    # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºå¹¶å†™å…¥è¡¨å¤´
    if not os.path.exists(attendance_file):
        with open(attendance_file, 'w', newline='', encoding='utf-8') as f:
            writer = csv.writer(f)
            writer.writerow(['å§“å', 'æ—¶é—´', 'çŠ¶æ€', 'ç½®ä¿¡åº¦'])
    
    # è¯»å–ä»Šæ—¥å·²æœ‰è®°å½•ï¼Œé¿å…é‡å¤
    today = datetime.now().strftime('%Y-%m-%d')
    existing_records = []
    
    try:
        with open(attendance_file, 'r', encoding='utf-8') as f:
            reader = csv.reader(f)
            next(reader)  # è·³è¿‡è¡¨å¤´
            for row in reader:
                if len(row) >= 2 and row[1].startswith(today):
                    existing_records.append(row[0])
    except FileNotFoundError:
        pass
    
    # è®°å½•è€ƒå‹¤
    if pred_label not in existing_records:
        with open(attendance_file, 'a', newline='', encoding='utf-8') as f:
            writer = csv.writer(f)
            writer.writerow([pred_label, now, 'Present', f'{confidence:.3f}'])
        print(f"è€ƒå‹¤æˆåŠŸï¼š{pred_label} {now} (ç½®ä¿¡åº¦: {confidence:.3f})")
        return True
    else:
        print(f"ä»Šæ—¥å·²è€ƒå‹¤ï¼š{pred_label}")
        return False</code></pre>
                    </div>
                </div>

                <div class="code-container">
                    <div class="code-header">
                        <span>ğŸ”„ å®Œæ•´è€ƒå‹¤ç³»ç»Ÿä¸»å‡½æ•°</span>
                        <button class="download-btn" onclick="downloadCode('attendance_main')">
                            ğŸ“¥ ä¸‹è½½ä»£ç 
                        </button>
                    </div>
                    <div class="code-content">
<pre><code>def attendance_system():
    """åŸºäºç‰¹å¾è„¸çš„è€ƒå‹¤ç³»ç»Ÿä¸»å‡½æ•°"""
    print("=== ç‰¹å¾è„¸è€ƒå‹¤ç³»ç»Ÿ ===")
    
    # æ£€æŸ¥è®­ç»ƒæ•°æ®
    if not os.path.exists('dataset') or len(os.listdir('dataset')) == 0:
        print("âŒ æœªæ‰¾åˆ°è®­ç»ƒæ•°æ®ï¼Œè¯·å…ˆé‡‡é›†äººè„¸æ ·æœ¬")
        return
    
    # åŠ è½½è®­ç»ƒæ•°æ®
    print("ğŸ“š åŠ è½½è®­ç»ƒæ•°æ®...")
    train_images, train_labels = get_images('dataset')
    
    # è®­ç»ƒç‰¹å¾è„¸æ¨¡å‹
    print("ğŸ§  è®­ç»ƒç‰¹å¾è„¸æ¨¡å‹...")
    eigenfaces, avg_img, train_projections = eigen_train(train_images, K=20)
    print(f"âœ… æ¨¡å‹è®­ç»ƒå®Œæˆï¼Œä½¿ç”¨ {eigenfaces.shape[1]} ä¸ªç‰¹å¾è„¸")
    
    # å¯åŠ¨å®æ—¶è¯†åˆ«
    print("ğŸ¯ å¯åŠ¨å®æ—¶äººè„¸è¯†åˆ«...")
    cap = cv2.VideoCapture(0)
    face_cascade = cv2.CascadeClassifier(cv2.data.haarcascades + 'haarcascade_frontalface_default.xml')
    
    print("æŒ‰ 's' é”®è¿›è¡Œè€ƒå‹¤è¯†åˆ«ï¼ŒæŒ‰ 'c' é”®é‡‡é›†æ–°æ ·æœ¬ï¼ŒæŒ‰ 'q' é”®é€€å‡º")
    
    while True:
        ret, frame = cap.read()
        if not ret:
            break
        
        gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)
        faces = face_cascade.detectMultiScale(gray, 1.3, 5)
        
        for (x, y, w, h) in faces:
            cv2.rectangle(frame, (x, y), (x+w, y+h), (0, 255, 0), 2)
            cv2.putText(frame, 'Face Detected', (x, y-10), 
                       cv2.FONT_HERSHEY_SIMPLEX, 0.7, (0, 255, 0), 2)
        
        cv2.imshow('è€ƒå‹¤ç³»ç»Ÿ', frame)
        
        key = cv2.waitKey(1) & 0xFF
        if key == ord('s') and len(faces) > 0:  # è€ƒå‹¤è¯†åˆ«
            x, y, w, h = faces[0]
            face_roi = cv2.resize(gray[y:y+h, x:x+w], (50, 50))
            test_img = face_roi.flatten().reshape(-1, 1)
            
            # è¿›è¡Œè¯†åˆ«
            predictions, confidences = eigen_test(test_img, eigenfaces, avg_img, 
                                                 train_projections, train_labels)
            
            if confidences[0] > 0.3:  # ç½®ä¿¡åº¦é˜ˆå€¼
                record_attendance(predictions[0], confidences[0])
            else:
                print("âŒ è¯†åˆ«å¤±è´¥ï¼Œç½®ä¿¡åº¦è¿‡ä½")
                
        elif key == ord('c'):  # é‡‡é›†æ–°æ ·æœ¬
            name = input("è¯·è¾“å…¥å§“å: ")
            capture_face(name)
            # é‡æ–°è®­ç»ƒæ¨¡å‹
            train_images, train_labels = get_images('dataset')
            eigenfaces, avg_img, train_projections = eigen_train(train_images, K=20)
            print("âœ… æ¨¡å‹å·²æ›´æ–°")
            
        elif key == ord('q'):
            break
    
    cap.release()
    cv2.destroyAllWindows()</code></pre>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3>ğŸ¯ åº”ç”¨åœºæ™¯ä¸ä¼˜åŠ¿</h3>
                <div class="result-grid">
                    <div class="result-card">
                        <h4>ğŸ« æ•™è‚²åœºæ™¯</h4>
                        <p>è¯¾å ‚è€ƒå‹¤ã€å®éªŒå®¤é—¨ç¦ã€å›¾ä¹¦é¦†ç®¡ç†</p>
                    </div>
                    <div class="result-card">
                        <h4>ğŸ¢ ä¼ä¸šåº”ç”¨</h4>
                        <p>å‘˜å·¥æ‰“å¡ã€ä¼šè®®ç­¾åˆ°ã€è®¿å®¢ç®¡ç†</p>
                    </div>
                    <div class="result-card">
                        <h4>ğŸ”’ å®‰é˜²ç›‘æ§</h4>
                        <p>å°åŒºé—¨ç¦ã€åŠå…¬æ¥¼ç®¡ç†ã€é‡è¦åŒºåŸŸç›‘æ§</p>
                    </div>
                </div>
                
                <div class="alert alert-info">
                    <strong>æŠ€æœ¯ä¼˜åŠ¿ï¼š</strong>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>ç®—æ³•ç®€å•ï¼Œè®¡ç®—æ•ˆç‡é«˜ï¼Œé€‚åˆå®æ—¶åº”ç”¨</li>
                        <li>å¯¹ç¡¬ä»¶è¦æ±‚ä½ï¼Œå¯åœ¨æ™®é€šPCä¸Šè¿è¡Œ</li>
                        <li>è®­ç»ƒæ•°æ®éœ€æ±‚ç›¸å¯¹è¾ƒå°‘ï¼Œæ˜“äºéƒ¨ç½²</li>
                        <li>å¯è§†åŒ–æ•ˆæœå¥½ï¼Œä¾¿äºç†è§£å’Œè°ƒè¯•</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>ğŸ“ ç‰¹å¾è„¸æ–¹æ³•å®éªŒæ•™å­¦ç½‘é¡µ | åŸºäºä¸»æˆåˆ†åˆ†æçš„äººè„¸è¯†åˆ«æŠ€æœ¯</p>
        <p>ğŸ’¡ é€šè¿‡ç†è®ºå­¦ä¹ ã€ä»£ç å®è·µå’Œäº¤äº’æ¼”ç¤ºï¼Œæ·±å…¥ç†è§£è®¡ç®—æœºè§†è§‰ä¸­çš„ç»å…¸ç®—æ³•</p>
    </div>

    <script>
        // æ ‡ç­¾é¡µåˆ‡æ¢åŠŸèƒ½
        function showSection(sectionId) {
            // éšè—æ‰€æœ‰å†…å®¹åŒºåŸŸ
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„activeçŠ¶æ€
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„å†…å®¹åŒºåŸŸ
            document.getElementById(sectionId).classList.add('active');
            
            // æ·»åŠ é€‰ä¸­æ ‡ç­¾çš„activeçŠ¶æ€
            event.target.classList.add('active');
        }

        // ä»£ç ä¸‹è½½åŠŸèƒ½
        function downloadCode(codeType) {
            const codeMap = {
                'get_images': `import matplotlib.pyplot as plt
import numpy as np
from PIL import Image
import os

def get_images(path):
    """è¯»å–æ–‡ä»¶å¤¹ä¸­çš„äººè„¸å›¾åƒï¼Œè¿”å›å±•å¹³åçš„å›¾åƒçŸ©é˜µå’Œæ ‡ç­¾"""
    image_paths = [os.path.join(path, f) for f in os.listdir(path) if f.endswith('png')]
    first_img = Image.open(image_paths[0]).convert('L')
    img_size = first_img.size[0] * first_img.size[1]
    
    images = np.zeros((len(image_paths), img_size))
    labels = []
    
    for idx, img_path in enumerate(image_paths):
        img = Image.open(img_path).convert('L')
        img_array = np.array(img, 'uint8')
        img_flat = img_array.flatten()
        images[idx, :] = img_flat
        filename = os.path.basename(img_path)
        label = filename.split('_')[0][-2:]
        labels.append(label)
    
    return images.T, labels`,
                'eigen_train': `import numpy as np

def eigen_train(trainset, K=10):
    """è®­ç»ƒç‰¹å¾è„¸æ¨¡å‹ï¼Œè¿”å›top-Kç‰¹å¾è„¸ã€å¹³å‡è„¸ã€è®­ç»ƒæ ·æœ¬æŠ•å½±"""
    # è®¡ç®—å¹³å‡è„¸
    avg_img = np.mean(trainset, axis=1, keepdims=True)
    
    # è®¡ç®—å·®å€¼çŸ©é˜µï¼ˆå»ä¸­å¿ƒåŒ–ï¼‰
    diff = trainset - avg_img
    
    # è®¡ç®—åæ–¹å·®çŸ©é˜µ C = A^T * Aï¼ˆé™ç»´æŠ€å·§ï¼‰
    cov_matrix = (diff.T @ diff) / float(diff.shape[1])
    
    # ç‰¹å¾å€¼åˆ†è§£
    eig_vals, eig_vects = np.linalg.eig(cov_matrix)
    
    # æŒ‰ç‰¹å¾å€¼å¤§å°æ’åºï¼Œé€‰æ‹©å‰Kä¸ª
    sorted_idx = np.argsort(eig_vals)[::-1]
    top_eig_vects = eig_vects[:, sorted_idx[:K]]
    
    # è®¡ç®—çœŸæ­£çš„ç‰¹å¾å‘é‡ï¼ˆç‰¹å¾è„¸ï¼‰
    eigenfaces = diff @ top_eig_vects
    
    # å½’ä¸€åŒ–ç‰¹å¾è„¸
    for i in range(K):
        eigenfaces[:, i] = eigenfaces[:, i] / np.linalg.norm(eigenfaces[:, i])
    
    # è®¡ç®—è®­ç»ƒæ ·æœ¬åœ¨ç‰¹å¾è„¸ç©ºé—´çš„æŠ•å½±
    train_projections = eigenfaces.T @ diff
    
    return eigenfaces, avg_img, train_projections`,
                'eigen_test': `import numpy as np

def eigen_test(testset, eigenfaces, avg_img, train_projections, train_labels):
    """ä½¿ç”¨ç‰¹å¾è„¸æ¨¡å‹è¿›è¡Œäººè„¸è¯†åˆ«æµ‹è¯•"""
    predictions = []
    confidences = []
    
    for i in range(testset.shape[1]):
        # æµ‹è¯•å›¾åƒå»ä¸­å¿ƒåŒ–
        test_img = testset[:, i:i+1] - avg_img
        
        # æŠ•å½±åˆ°ç‰¹å¾è„¸ç©ºé—´
        test_projection = eigenfaces.T @ test_img
        
        # è®¡ç®—ä¸æ‰€æœ‰è®­ç»ƒæ ·æœ¬çš„æ¬§æ°è·ç¦»
        distances = []
        for j in range(train_projections.shape[1]):
            train_proj = train_projections[:, j:j+1]
            dist = np.linalg.norm(test_projection - train_proj)
            distances.append(dist)
        
        # æ‰¾åˆ°æœ€è¿‘é‚»
        min_idx = np.argmin(distances)
        min_distance = distances[min_idx]
        
        # é¢„æµ‹æ ‡ç­¾å’Œç½®ä¿¡åº¦ï¼ˆè·ç¦»è¶Šå°ç½®ä¿¡åº¦è¶Šé«˜ï¼‰
        pred_label = train_labels[min_idx]
        confidence = 1.0 / (1.0 + min_distance)  # ç®€å•çš„ç½®ä¿¡åº¦è®¡ç®—
        
        predictions.append(pred_label)
        confidences.append(confidence)
    
    return predictions, confidences`,
                'attendance_system': `import csv
import os
from datetime import datetime

def record_attendance(pred_label, confidence=0.0, attendance_file='attendance.csv'):
    """è®°å½•è€ƒå‹¤ç»“æœï¼ˆå§“åã€æ—¶é—´ã€çŠ¶æ€ã€ç½®ä¿¡åº¦ï¼‰"""
    now = datetime.now().strftime('%Y-%m-%d %H:%M:%S')
    
    # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºå¹¶å†™å…¥è¡¨å¤´
    if not os.path.exists(attendance_file):
        with open(attendance_file, 'w', newline='', encoding='utf-8') as f:
            writer = csv.writer(f)
            writer.writerow(['å§“å', 'æ—¶é—´', 'çŠ¶æ€', 'ç½®ä¿¡åº¦'])
    
    # è¯»å–ä»Šæ—¥å·²æœ‰è®°å½•ï¼Œé¿å…é‡å¤
    today = datetime.now().strftime('%Y-%m-%d')
    existing_records = []
    
    try:
        with open(attendance_file, 'r', encoding='utf-8') as f:
            reader = csv.reader(f)
            next(reader)  # è·³è¿‡è¡¨å¤´
            for row in reader:
                if len(row) >= 2 and row[1].startswith(today):
                    existing_records.append(row[0])
    except FileNotFoundError:
        pass
    
    # è®°å½•è€ƒå‹¤
    if pred_label not in existing_records:
        with open(attendance_file, 'a', newline='', encoding='utf-8') as f:
            writer = csv.writer(f)
            writer.writerow([pred_label, now, 'Present', f'{confidence:.3f}'])
        print(f"è€ƒå‹¤æˆåŠŸï¼š{pred_label} {now} (ç½®ä¿¡åº¦: {confidence:.3f})")
        return True
    else:
        print(f"ä»Šæ—¥å·²è€ƒå‹¤ï¼š{pred_label}")
        return False`,
                'attendance_main': `import cv2
import os
import numpy as np
from datetime import datetime

def attendance_system():
    """åŸºäºç‰¹å¾è„¸çš„è€ƒå‹¤ç³»ç»Ÿä¸»å‡½æ•°"""
    print("=== ç‰¹å¾è„¸è€ƒå‹¤ç³»ç»Ÿ ===")
    
    # æ£€æŸ¥è®­ç»ƒæ•°æ®
    if not os.path.exists('dataset') or len(os.listdir('dataset')) == 0:
        print("âŒ æœªæ‰¾åˆ°è®­ç»ƒæ•°æ®ï¼Œè¯·å…ˆé‡‡é›†äººè„¸æ ·æœ¬")
        return
    
    # åŠ è½½è®­ç»ƒæ•°æ®
    print("ğŸ“š åŠ è½½è®­ç»ƒæ•°æ®...")
    train_images, train_labels = get_images('dataset')
    
    # è®­ç»ƒç‰¹å¾è„¸æ¨¡å‹
    print("ğŸ§  è®­ç»ƒç‰¹å¾è„¸æ¨¡å‹...")
    eigenfaces, avg_img, train_projections = eigen_train(train_images, K=20)
    print(f"âœ… æ¨¡å‹è®­ç»ƒå®Œæˆï¼Œä½¿ç”¨ {eigenfaces.shape[1]} ä¸ªç‰¹å¾è„¸")
    
    # å¯åŠ¨å®æ—¶è¯†åˆ«
    print("ğŸ¯ å¯åŠ¨å®æ—¶äººè„¸è¯†åˆ«...")
    cap = cv2.VideoCapture(0)
    face_cascade = cv2.CascadeClassifier(cv2.data.haarcascades + 'haarcascade_frontalface_default.xml')
    
    print("æŒ‰ 's' é”®è¿›è¡Œè€ƒå‹¤è¯†åˆ«ï¼ŒæŒ‰ 'c' é”®é‡‡é›†æ–°æ ·æœ¬ï¼ŒæŒ‰ 'q' é”®é€€å‡º")
    
    while True:
        ret, frame = cap.read()
        if not ret:
            break
        
        gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)
        faces = face_cascade.detectMultiScale(gray, 1.3, 5)
        
        for (x, y, w, h) in faces:
            cv2.rectangle(frame, (x, y), (x+w, y+h), (0, 255, 0), 2)
            cv2.putText(frame, 'Face Detected', (x, y-10), 
                       cv2.FONT_HERSHEY_SIMPLEX, 0.7, (0, 255, 0), 2)
        
        cv2.imshow('è€ƒå‹¤ç³»ç»Ÿ', frame)
        
        key = cv2.waitKey(1) & 0xFF
        if key == ord('s') and len(faces) > 0:  # è€ƒå‹¤è¯†åˆ«
            x, y, w, h = faces[0]
            face_roi = cv2.resize(gray[y:y+h, x:x+w], (50, 50))
            test_img = face_roi.flatten().reshape(-1, 1)
            
            # è¿›è¡Œè¯†åˆ«
            predictions, confidences = eigen_test(test_img, eigenfaces, avg_img, 
                                                 train_projections, train_labels)
            
            if confidences[0] > 0.3:  # ç½®ä¿¡åº¦é˜ˆå€¼
                record_attendance(predictions[0], confidences[0])
            else:
                print("âŒ è¯†åˆ«å¤±è´¥ï¼Œç½®ä¿¡åº¦è¿‡ä½")
                
        elif key == ord('c'):  # é‡‡é›†æ–°æ ·æœ¬
            name = input("è¯·è¾“å…¥å§“å: ")
            capture_face(name)
            # é‡æ–°è®­ç»ƒæ¨¡å‹
            train_images, train_labels = get_images('dataset')
            eigenfaces, avg_img, train_projections = eigen_train(train_images, K=20)
            print("âœ… æ¨¡å‹å·²æ›´æ–°")
            
        elif key == ord('q'):
            break
    
    cap.release()
    cv2.destroyAllWindows()

if __name__ == "__main__":
    attendance_system()`
            };
            
            const code = codeMap[codeType] || '# ä»£ç å†…å®¹';
            const blob = new Blob([code], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${codeType}.py`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            // æ˜¾ç¤ºä¸‹è½½æç¤º
            alert(`âœ… ${codeType}.py ä»£ç æ–‡ä»¶ä¸‹è½½æˆåŠŸï¼`);
        }

        // äº¤äº’æ¼”ç¤ºåŠŸèƒ½
        function simulateDataCollection() {
            const output = document.getElementById('demo-output');
            output.innerHTML = `
                <div style="color: #00ff88;">ğŸ“· æ­£åœ¨å¯åŠ¨æ‘„åƒå¤´...</div>
                <div style="color: #ffaa00; margin-top: 5px;">ğŸ” æ£€æµ‹åˆ°äººè„¸ï¼Œå‡†å¤‡é‡‡é›†æ ·æœ¬</div>
                <div style="color: #88ccff; margin-top: 5px;">ğŸ“¸ å·²é‡‡é›†æ ·æœ¬ 1/5 - å¼ ä¸‰</div>
                <div style="color: #88ccff; margin-top: 5px;">ğŸ“¸ å·²é‡‡é›†æ ·æœ¬ 2/5 - å¼ ä¸‰</div>
                <div style="color: #88ccff; margin-top: 5px;">ğŸ“¸ å·²é‡‡é›†æ ·æœ¬ 3/5 - å¼ ä¸‰</div>
                <div style="color: #88ccff; margin-top: 5px;">ğŸ“¸ å·²é‡‡é›†æ ·æœ¬ 4/5 - å¼ ä¸‰</div>
                <div style="color: #88ccff; margin-top: 5px;">ğŸ“¸ å·²é‡‡é›†æ ·æœ¬ 5/5 - å¼ ä¸‰</div>
                <div style="color: #00ff88; margin-top: 10px;">âœ… æ•°æ®é‡‡é›†å®Œæˆï¼å·²ä¿å­˜è‡³ dataset/å¼ ä¸‰/ æ–‡ä»¶å¤¹</div>
            `;
        }

        function simulateTraining() {
            const output = document.getElementById('demo-output');
            output.innerHTML = `
                <div style="color: #00ff88;">ğŸ§  æ­£åœ¨åŠ è½½è®­ç»ƒæ•°æ®...</div>
                <div style="color: #88ccff; margin-top: 5px;">ğŸ“Š è®­ç»ƒé›†: 150 å¼ å›¾ç‰‡ï¼Œ10 ä¸ªäºº</div>
                <div style="color: #ffaa00; margin-top: 5px;">âš™ï¸ è®¡ç®—å¹³å‡è„¸...</div>
                <div style="color: #ffaa00; margin-top: 5px;">ğŸ”¢ è®¡ç®—åæ–¹å·®çŸ©é˜µ...</div>
                <div style="color: #ffaa00; margin-top: 5px;">ğŸ“ˆ ç‰¹å¾å€¼åˆ†è§£ä¸­...</div>
                <div style="color: #ffaa00; margin-top: 5px;">ğŸ¯ æå–å‰20ä¸ªä¸»æˆåˆ†...</div>
                <div style="color: #88ccff; margin-top: 5px;">ğŸ“‰ ç‰¹å¾å€¼: [2847.3, 1923.7, 1456.2, 1089.4, ...]</div>
                <div style="color: #00ff88; margin-top: 10px;">âœ… æ¨¡å‹è®­ç»ƒå®Œæˆï¼å‡†ç¡®ç‡: 94.2%</div>
            `;
        }

        function simulateRecognition() {
            const output = document.getElementById('demo-output');
            output.innerHTML = `
                <div style="color: #00ff88;">ğŸ¯ å¯åŠ¨å®æ—¶è¯†åˆ«ç³»ç»Ÿ...</div>
                <div style="color: #88ccff; margin-top: 5px;">ğŸ“¹ æ‘„åƒå¤´å·²å°±ç»ª</div>
                <div style="color: #ffaa00; margin-top: 5px;">ğŸ” æ£€æµ‹åˆ°äººè„¸...</div>
                <div style="color: #88ccff; margin-top: 5px;">ğŸ§® è®¡ç®—ç‰¹å¾å‘é‡æŠ•å½±...</div>
                <div style="color: #88ccff; margin-top: 5px;">ğŸ“ è®¡ç®—æ¬§æ°è·ç¦»...</div>
                <div style="color: #00ff88; margin-top: 5px;">âœ… è¯†åˆ«æˆåŠŸ: å¼ ä¸‰ (ç½®ä¿¡åº¦: 0.87)</div>
                <div style="color: #00ff88; margin-top: 5px;">ğŸ“ è€ƒå‹¤è®°å½•å·²æ›´æ–°</div>
                <div style="color: #ffaa00; margin-top: 10px;">ğŸ”„ ç»§ç»­ç›‘æ§ä¸­...</div>
            `;
        }

        function showAttendanceRecord() {
            const output = document.getElementById('demo-output');
            output.innerHTML = `
                <div style="color: #00ff88;">ğŸ“‹ è€ƒå‹¤è®°å½•æŸ¥è¯¢</div>
                <div style="color: #88ccff; margin-top: 10px;">==========================================</div>
                <div style="color: #ffffff; margin-top: 5px;">å§“å    |  æ—¶é—´           |  çŠ¶æ€   |  ç½®ä¿¡åº¦</div>
                <div style="color: #88ccff; margin-top: 5px;">------------------------------------------</div>
                <div style="color: #ffffff; margin-top: 5px;">å¼ ä¸‰    |  2024-01-15 08:30  |  Present  |  0.87</div>
                <div style="color: #ffffff; margin-top: 5px;">æå››    |  2024-01-15 08:32  |  Present  |  0.92</div>
                <div style="color: #ffffff; margin-top: 5px;">ç‹äº”    |  2024-01-15 08:35  |  Present  |  0.78</div>
                <div style="color: #ffffff; margin-top: 5px;">èµµå…­    |  2024-01-15 08:38  |  Present  |  0.85</div>
                <div style="color: #88ccff; margin-top: 5px;">==========================================</div>
                <div style="color: #00ff88; margin-top: 10px;">ğŸ“Š ä»Šæ—¥å‡ºå‹¤ç‡: 4/10 (40%)</div>
            `;
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ­ ç‰¹å¾è„¸æ–¹æ³•å®éªŒæ•™å­¦ç½‘é¡µåŠ è½½å®Œæˆï¼');
        });
    </script>
</body>
</html>